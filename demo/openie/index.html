<html>
    <head>
        <title>
            Supervised Open IE demo (beta)
        </title>
        <style>
           .pagination a {
                color: black;
                float: left;
                padding: 8px 16px;
                text-decoration: none;
                transition: background-color .3s;
            }

            .pagination a.active {
                background-color: dodgerblue;
                color: white;
            }

            .pagination a:hover:not(.active) {background-color: #ddd;}
        </style>
        <link rel = "stylesheet" type = "text/css" href = "demo.css" />
        <script src="//unpkg.com/hierplane/dist/static/hierplane.min.js"></script>
        <link rel="stylesheet" type="text/css" href="//unpkg.com/hierplane/dist/static/hierplane.min.css">
        <!--<script>-->
            <!--import { expandAllNodes } from 'ui.js';-->
        <!--</script>-->

    </head>
    <body>
        <div class="pane-container">
            <div class="pane model">
                <div class="pane__left model__input">
                    <div class="model__content">
                        <h2><span><a href="https://gabrielstanovsky.github.io/assets/papers/naacl18long/paper.pdf" target="_blank">Supervised Open IE (Beta)</a></span></h2>
                        <div class="model__content">
                            <div class="form__instructions"><span></span>
                            <select onclick="prefill()" id="unfilled">
                              <option value="">Choose an example...</option>
                              <option value="2">John gave the letter to Mary.</option>
                              <option value="3">On earth, gravity pulls the marble to the ground .</option>
                              <option value="1">Plants provide animals with oxygen that they breathe in.</option>
                              <option value="4">On a 394 - 21 roll call , the House adopted the underlying transportation measure .</option>
                              <option value="6">Premark International Inc. for example , peddles the M8.7sp Electronic Cycling Simulator .</option>
                              <option value="5">The latest research pact bolsters Du Pont 's growing portfolio of investments in superconductors .</option>
			      <option value="0">Yesterday , Nekoosa common closed in composite New York Stock Exchange trading at $ 62.875 , up $ 20.125 , on volume of almost 6.3 million shares .</option>



                            </select>
                            </div>

                            <div class="form__field">
                                <label for="input-sentence_tokens">Input text</label>
                                <textarea type="text" id="input-sentence_tokens" type="text" required value placeholder="Enter a sentence."></textarea>
                            </div>

                            <div class="form__field form__field--btn">
                                <button type="button" class="btn btn--icon-disclosure" onclick="predict()">Extract</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pane__right model__output model__output--empty">
                    <div class="pane__thumb"></div>

                    <!--Added for pagination-->
                    <!--Uncomment for design 1-->
                    <div class="pagination" style="visibility: hidden;">
                      <button class="active" onclick="display_hierplane_global_val(0)">1</button>
                      <button onclick="display_hierplane_global_val(1)">2</button>
                      <button onclick="display_hierplane_global_val(2)">3</button>
                      <button onclick="display_hierplane_global_val(3)">4</button>
                    </div>


                    <div class="model__content">
                        <div id="output" class="output">
                            <div class="placeholder">
                                <div class="placeholder__content">
                                    <p>Extract using Neural Open IE to view results</p>
                                </div>
                            </div>
                        </div>


                        <!--Added for hierplane-->
                        <div id="hierplane_output"> </div>
                        <!--<div id="hierplane_output_0"> </div>-->

                    </div>
                </div>
            </div>
        </div>
            <script>

        function display_hierplane_global_val(tree_idx){
            hierplane.renderTree(global_hierplane[tree_idx], options = { target: '#hierplane_output', theme: 'dark'});
        }

        function display_hierplane_merged(the_tree){
            // hierplane.expandAllNodes();
            hierplane.renderTree(the_tree, options = { target: '#hierplane_output', theme: 'dark'});
            // Hide the automatically concatenated text that is less relevant for open IE but more for parse trees
            // div id="passage"
            document.getElementById("passage").style.visibility = 'hidden';
            // import { collapseAllNodes, expandAllNodes } from './stores/modules/ui';
            // expandAllNodes();
            // FIXME: for async operation hierplane to render, we might need to wait.
            var expansionFn = document.getElementsByClassName("tree-expansion-control__trigger");
            // console.log(logged);
            expansionFn[1].click(); // Expand nodes by default.
        }

    </script>

    </body>
    <script>

    var global_hierplane;

    function predict() {
        // Clear previous response.
        document.getElementById("output").innerHTML = "";

        var quotedFieldList = ['sentence_tokens'];
        var data = {};
        quotedFieldList.forEach(function(fieldName) {
            data[fieldName] = document.getElementById("input-" + fieldName).value;
        })

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/predict');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onload = function() {
            if (xhr.status == 200) {
				// var htmlResults = "<pre>" + JSON.stringify(obj, null, 2) + "</pre>";



				var tableResults = ""; // div contains all tables.
				// obj is an array of dictionaries (one per predicate) e.g., verb:eat, A1:fruit
                var tag_span_dicts = JSON.parse(xhr.responseText)['tag_spans'];
				var tokens = JSON.parse(xhr.responseText)['tokens'];
                var x = "";
                var expected_order = ['ARG0', 'BV', 'V', 'AV', 'ARG1', 'ARG2', 'ARG3', 'ARG4', 'ARG5'];
				tableResults += "<div><p>"+ tokens.join(" ") +"</p></div>";

				// one sentence can have multiple openie tuples, one per predicate.
				for (tag_spans_curr_index in tag_span_dicts){
				    // k is a dictionary key i.e. label name.

            for (i=0; i < expected_order.length ; i++){

              var x = expected_order[i];
					for (span_label in tag_span_dicts[tag_spans_curr_index]){

						if(span_label){
							  //
							  var rows = "";

									if(x == span_label){
										  {
                        tableResults += "<div><table>";
											  tableResults+= "\n<tr><td><b>" + x + "</b></td>";
											  tableResults+= "<td>" + tag_span_dicts[tag_spans_curr_index][span_label] + "</td></tr>\n";
                        tableResults += rows + "</table></div>";
										  }
									}
								  }
                //alert(tableResults)
							  //tableResults += rows + "</table></div>";
						} // closing if (k)

					}

				}

				document.getElementById("output").innerHTML = tableResults;
				//
				//
				// ///////////////////////////////////////
				// //  Uncomment this for design 1 //
				// ///////////////////////////////////////
				//global_hierplane = JSON.parse(xhr.responseText)['hierplane_inputs'];
				// display_hierplane_global_val(0);  // display the first element by default.
				//
				//
				//// /////////////////////////////////////
				//     This is design 2             //
				// ///////////////////////////////////////
				// display_hierplane_merged(JSON.parse(xhr.responseText)['hierplane_inputs_merged']);

            }
        };
        xhr.send(JSON.stringify(data));
    }
    </script>

    <script>
		var prefilledValues = [
		  "Yesterday , Nekoosa common closed in composite New York Stock Exchange trading at $ 62.875 , up $ 20.125 , on volume of almost 6.3 million shares .",
		  "Plants provide animals with oxygen that they breathe in.",
                  "John gave the letter to Mary.",
                  "On earth, gravity pulls the marble to the ground .",
                  "On a 394 - 21 roll call , the House adopted the underlying transportation measure .",
                  "The latest research pact bolsters Du Pont 's growing portfolio of investments in superconductors .",
"Premark International Inc. for example , peddles the M8.7sp Electronic Cycling Simulator ."
		];

		function prefill() {
			var selectedIndex = parseInt(document.getElementById("unfilled").value);
			var fetchedValue = prefilledValues[selectedIndex];
			document.getElementById("input-sentence_tokens").value = fetchedValue.split("\t").join("\n");
		}
    </script>
</html>
