<html>
    <head>
        <title>
            Neural Open IE demo
        </title>
        <link rel = "stylesheet" type = "text/css" href = "demo.css" />
    </head>
    <body>
        <div class="pane-container">
            <div class="pane model">
                <div class="pane__left model__input">
                    <div class="model__content">
                        <h2><span><a href="https://gabrielstanovsky.github.io/assets/papers/naacl18long/paper.pdf">Neural Open IE</a></span></h2>
                        <div class="model__content">                            
                            <div class="form__instructions"><span></span>
                            <select onclick="prefill()" id="unfilled">
                                <option value="">Choose an example...</option>
								<option value="0">Angela Merkel met and spoke to her EU counterparts during the climate submit in Paris.</option>
								<option value="1">Plants provide animals with oxygen that they breathe in.</option>
                            </select>
                            </div>

                            <div class="form__field">
                                <label for="input-sentence_tokens">Input text</label>
                                <textarea type="text" id="input-sentence_tokens" type="text" required value placeholder="Enter a sentence."></textarea>
                            </div>

                            <div class="form__field form__field--btn">
                                <button type="button" class="btn btn--icon-disclosure" onclick="predict()">Extract</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pane__right model__output model__output--empty">
                    <div class="pane__thumb"></div>
                    <div class="model__content">
                        <div id="output" class="output">
                            <div class="placeholder">
                                <div class="placeholder__content">
                                    <p>Extract using Neural Open IE to view results</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script>

    function predict() {
        // Clear previous response.    
        document.getElementById("output").innerHTML = "";

        var quotedFieldList = ['sentence_tokens'];
        var data = {};
        quotedFieldList.forEach(function(fieldName) {
            data[fieldName] = document.getElementById("input-" + fieldName).value;
        })

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/predict');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onload = function() {
            if (xhr.status == 200) {
				// var htmlResults = "<pre>" + JSON.stringify(obj, null, 2) + "</pre>";
				
				
				
				var tableResults = ""; // div contains all tables.
				// obj is an array of dictionaries (one per predicate) e.g., verb:eat, A1:fruit
                var tag_span_dicts = JSON.parse(xhr.responseText)['tag_spans']; 
				var tokens = JSON.parse(xhr.responseText)['tokens'];
                var x = "";
                var expected_order = ['A0', 'P', 'A1', 'A2', 'A3', 'A4', 'A5'];
				tableResults += "<div><p>"+ tokens.join(" ") +"</p></div>";
				
				// one sentence can have multiple openie tuples, one per predicate.
				for (tag_spans_curr_index in tag_span_dicts){
				    // k is a dictionary key i.e. label name.
					for (span_label in tag_span_dicts[tag_spans_curr_index]){
					
						if(span_label){
							  tableResults += "<div><table>";
							  var rows = "";
							  for (i=0; i < expected_order.length ; i++){
									var x = expected_order[i];
									if(x == span_label){
										  {   
											  tableResults+= "\n<tr><td><b>" + x + "</b></td>";
											  tableResults+= "<td>" + tag_span_dicts[tag_spans_curr_index][span_label] + "</td></tr>\n";
										  }
									}
								  }
							  tableResults += rows + "</table></div>";
						} // closing if (k)
						
					}
										
				}
				document.getElementById("output").innerHTML = tableResults;
				
				
				
				
				
				
// 				document.getElementById("output").innerHTML = htmlResults;
            }
        };
        xhr.send(JSON.stringify(data));
    }
    </script>
    
    <script>    
		var prefilledValues = [
		  "Angela Merkel met and spoke to her EU counterparts during the climate submit in Paris.",
		  "Plants provide animals with oxygen that they breathe in."
		];
		
		function prefill() {
			var selectedIndex = parseInt(document.getElementById("unfilled").value);
			var fetchedValue = prefilledValues[selectedIndex];
			document.getElementById("input-sentence_tokens").value = fetchedValue.split("\t").join("\n");
		}
    </script>
</html>
